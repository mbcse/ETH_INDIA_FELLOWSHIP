<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
        <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
        <script src="web3.min.js"></script>
        <script src="web3APP.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    </head>
    <body>
          
          <h1 style="text-align: center;">Write a Post</h1>

          <form action="">
           
           Title: &nbsp;<input type="text" id="title" name="title">
           <br>
           Image: <input type="file" id="image" >
           <br>
           Content: <input type="text" name="" id="tarea">
          <br>
        
          </form>
        
          <button id="post" >Submit</button>
       
        <script>
            var simplemde = new SimpleMDE({ element: document.getElementById("tarea") });
            setInterval(()=>{
                console.log(simplemde.value());
            },3000);
        </script>

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>


        <script>
document.getElementById('post').addEventListener("click", ()=>{

       var title=document.getElementById('title').value;
       var fd = new FormData();
        var files = $('#image')[0].files[0];
        fd.append('file',files);
        fd.append('markdown',simplemde.value());
        
        $.ajax({
            url: '/gethash',
            type: 'post',
            data: fd,
            contentType: false,
            processData: false,
            success: function(response){
                console.log(response);
                if(response.markdownHash != "" && response.imageHash!=""){
                     
                    bediumContract.methods.setNewPost(response.markdownHash, response.imageHash, title).send({from:userAccount}, (err,transactionHash)=>{
                        if(err){
                            console.log(err);
                        }
                        console.log(transactionHash);
                    });

                    
                }else{
                    alert('Something Went wrong');
                }
            },
        });
      





    // bediumContract.methods.approve("0x68fcdd4c4823538b1c81c4142b3fe8a72f9e4ea3",10).send({from:userAccount},function(error, transactionHash){
    //                         if(error){
    //                             console.log(error);
    //                         }
    //                         console.log(transactionHash);
    
    //                         });
});
             
    


        </script>
    </body>
</html>